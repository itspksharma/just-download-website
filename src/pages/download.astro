---
import MainLayout from '../layouts/MainLayout.astro';
import version from '../data/version.json';

const latest = version?.latest ?? {};
const assets = latest.assets ?? {};
const win = assets.windows ?? null;
const zip = assets.zip ?? null;
const linux = assets.linux ?? assets.linux ?? null;
const mac = assets.mac ?? null;
const android = assets.android ?? null;

const releasedAt = latest.released_at ? new Date(latest.released_at) : null;
function formatDate(d) {
  if (!d) return 'TBD';
  return d.toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' });
}
---

<MainLayout title={`Download - ${latest.version ?? 'Just-Download'}`}>
  <section class="max-w-5xl mx-auto px-6 py-8 space-y-6">
    <header class="mb-2">
      <h2 class="text-2xl font-semibold mb-2">Download</h2>
      <p class="text-sm text-slate-600">
        {latest.version ? `${latest.version} • Released ${releasedAt ? formatDate(releasedAt) : latest.released_at}` : 'No release information yet.'}
      </p>
      {latest.releases_page && (
        <p class="text-xs text-slate-400 mt-1">
          View full releases: <a class="text-indigo-600" href="" target="_blank" rel="noopener">Releases page</a>
        </p>
      )}
      {latest.notes && <p class="mt-3 text-sm text-slate-700">{latest.notes}</p>}
    </header>

    <div class="grid md:grid-cols-3 gap-4">
      <!-- Windows -->
      <div class="p-4 bg-white rounded shadow">
        <h3 class="font-medium">Windows</h3>
        <p class="text-sm text-slate-500 mt-2">{latest.version} • {releasedAt ? formatDate(releasedAt) : latest.released_at}</p>

        <div class="mt-4 space-y-2">
          {win?.url ? (
            <a class="w-full inline-block text-center px-4 py-2 bg-green-600 text-white rounded" href={} target="_blank" rel="noopener">
              Download {win.label ?? 'Installer'}
            </a>
          ) : (
            <span class="inline-block px-4 py-2 bg-gray-200 text-gray-600 rounded cursor-not-allowed">Installer Coming Soon</span>
          )}

          {zip?.url ? (
            <a class="w-full inline-block text-center px-4 py-2 border rounded" href="https://drive.google.com/file/d/19PlQkOT_-_0kcGE2IOlkqNl-dqRAG6kD/view?usp=sharing" target="_blank" rel="noopener">
              Download ZIP ({zip.label ?? 'Archive'})
            </a>
          ) : null}

          <div class="text-xs text-slate-400 mt-2">
            {win?.size ? <div>Size: {win.size}</div> : null}
            {win?.sha256 ? <div>SHA256: <code class="break-all">{win.sha256}</code></div> : null}
          </div>
        </div>
      </div>

      <!-- Linux -->
      <div class="p-4 bg-white rounded shadow">
        <h3 class="font-medium">Linux</h3>
        <p class="text-sm text-slate-500 mt-2">{linux?.status ?? 'Coming Soon'}</p>
        {linux?.url ? (
          <a class="mt-4 inline-block px-4 py-2 bg-indigo-600 text-white rounded" href={linux.url} target="_blank" rel="noopener">Download</a>
        ) : (
          <span class="mt-4 inline-block px-4 py-2 bg-gray-200 text-gray-600 rounded cursor-not-allowed">Coming Soon</span>
        )}
      </div>

      <!-- macOS / iOS -->
      <div class="p-4 bg-white rounded shadow">
        <h3 class="font-medium">macOS / iOS</h3>
        <p class="text-sm text-slate-500 mt-2">{mac?.status ?? 'Coming Soon'}</p>
        {mac?.url ? (
          <a class="mt-4 inline-block px-4 py-2 bg-indigo-600 text-white rounded" href={mac.url} target="_blank" rel="noopener">Download</a>
        ) : (
          <span class="mt-4 inline-block px-4 py-2 bg-gray-200 text-gray-600 rounded cursor-not-allowed">Coming Soon</span>
        )}
      </div>
    </div>

    <!-- Optional Android / Extra asset row -->
    <div class="mt-4">
      <h3 class="text-lg font-semibold mb-3">Other Builds</h3>
      <div class="grid md:grid-cols-3 gap-4">
        <div class="p-4 bg-white rounded shadow">
          <h4 class="font-medium">Android</h4>
          <p class="text-sm text-slate-500 mt-2">{android?.status ?? 'Coming Soon'}</p>
          {android?.url ? (
            <a class="mt-3 inline-block px-4 py-2 bg-indigo-600 text-white rounded" href={android.url} target="_blank" rel="noopener">Download APK</a>
          ) : (
            <span class="mt-3 inline-block px-4 py-2 bg-gray-200 text-gray-600 rounded cursor-not-allowed">Not Available</span>
          )}
        </div>

        <div class="p-4 bg-white rounded shadow">
          <h4 class="font-medium">Portable ZIP</h4>
          {zip?.url ? (
            <>
              <p class="text-sm text-slate-500 mt-2">{zip.label}</p>
              <a class="mt-3 inline-block px-4 py-2 border rounded" href="https://drive.google.com/file/d/19PlQkOT_-_0kcGE2IOlkqNl-dqRAG6kD/view?usp=sharing" target="_blank" rel="noopener">Download ZIP</a>
            </>
          ) : (
            <p class="text-sm text-slate-500 mt-2">Not available</p>
          )}
        </div>

        <div class="p-4 bg-white rounded shadow">
          <h4 class="font-medium">Checksums</h4>
          <p class="text-sm text-slate-500 mt-2">Verify the file integrity before installing.</p>
          <div class="mt-3 text-xs text-slate-600">
            {win?.sha256 ? <div>Windows SHA256: <code class="break-all">{win.sha256}</code></div> : <div>SHA256 not published</div>}
          </div>
        </div>
      </div>
    </div>
  </section>
</MainLayout>
